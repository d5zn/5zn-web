<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="description" content="5zn-web - Web application for 5zn project">
    <meta name="keywords" content="5zn, web, application, mobile, responsive">
    <meta http-equiv="Content-Security-Policy" content="default-src * 'unsafe-inline' 'unsafe-eval' data: blob:; script-src * 'unsafe-inline' 'unsafe-eval' 'unsafe-hashes'; style-src * 'unsafe-inline'; img-src * data: blob:; connect-src *; object-src *; media-src *; font-src *; worker-src *; manifest-src *; form-action *; base-uri *;">
    <title>5zn.io</title>
    <link rel="stylesheet" href="styles.css?v=56">
</head>
<body>
    <div class="mobile-container" id="mobile-container">
        <!-- Navigation Bar -->
        <nav class="navbar">
            <div class="nav-container">
                <div class="nav-brand">
                    <h1>5zn.io</h1>
                </div>
                <div class="nav-actions">
                    <button class="nav-btn" title="Select Workout" id="workout-selector-btn">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M3 6h18"/>
                            <path d="M3 12h18"/>
                            <path d="M3 18h18"/>
                        </svg>
                    </button>
                    <button class="nav-btn" title="Share" id="share-btn">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="18" cy="5" r="3"/>
                            <circle cx="6" cy="12" r="3"/>
                            <circle cx="18" cy="19" r="3"/>
                            <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/>
                            <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
                        </svg>
                    </button>
                    <button class="nav-btn" title="Logout" id="logout-btn">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                            <polyline points="16,17 21,12 16,7"/>
                            <line x1="21" y1="12" x2="9" y2="12"/>
                        </svg>
                    </button>
                </div>
            </div>
        </nav>

        <!-- Preview Area - –∫–∞–∫ –≤ VSCO -->
        <div class="preview-area ratio-9-16">
            <!-- Not Connected State -->
            <div id="not-connected" class="state-container">
                <div class="state-card">
                    <h2>Connect to Strava</h2>
                    <p>Visualize your cycling routes and workout data.</p>
                    <button id="connect-strava-btn" class="btn btn-primary" style="height: 40px; display: flex; align-items: center; justify-content: center;">Connect with Strava</button>
                </div>
            </div>

            <!-- Connected State - –ø—Ä–µ–≤—å—é –∫–∞–∫ –≤ VSCO -->
            <div id="connected" class="connected-state ratio-9-16 hidden">
                <!-- Preview Canvas -->
                <canvas id="route-canvas"></canvas>
                
                <!-- Stats Overlay -->
                <div class="stats-overlay">
                    <div class="stat-item">
                        <span class="stat-label">DISTANCE</span>
                        <span class="stat-value" id="distance-value">3 000 m</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">ELEVATION</span>
                        <span class="stat-value" id="elevation-value">3 000 m</span>
                    </div>
                </div>
                
                <!-- Bottom Stats Overlay -->
                <div class="bottom-stats-overlay">
                    <div class="stat-item">
                        <span class="stat-label">AVG SPEED</span>
                        <span class="stat-value" id="speed-value">15.2 km/h</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">TIME</span>
                        <span class="stat-value" id="time-value">1h 23m</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom Editing Panel -->
        <div class="editing-panel">
                <!-- Tab Navigation -->
            <div class="tab-nav">
                <button class="tab-btn active" data-tab="photo">PHOTO</button>
                <button class="tab-btn" data-tab="data">DATA</button>
                <button class="tab-btn" data-tab="colors" style="display: none;">COLORS</button>
                <button class="tab-btn" data-tab="ratio" style="display: none;">RATIO</button>
            </div>

                <!-- Tab Content -->
                <div class="tab-content">
                    <!-- Photo Tab -->
                    <div id="photo-tab" class="tab-panel active">
                        <button class="action-btn" id="upload-photo-btn" style="height: 40px; display: flex; align-items: center; justify-content: center;">Upload Photo</button>
                        <button class="action-btn" id="mono-toggle-btn" style="height: 40px; margin-top: 8px; display: none; align-items: center; justify-content: center;">Convert to Mono</button>
                    </div>

                    <!-- Data Tab -->
                    <div id="data-tab" class="tab-panel">
                        <div class="data-buttons">
                            <button class="data-btn active" data-metric="distance">Distance</button>
                            <button class="data-btn" data-metric="elevation">Elevation</button>
                            <button class="data-btn" data-metric="time">Time</button>
                            <button class="data-btn" data-metric="speed">Speed/Avg</button>
                            <button class="data-btn" data-metric="calories">Calories</button>
                            <button class="data-btn" data-metric="power">Power/Avg</button>
                        </div>
                    </div>

                    <!-- Logo Tab - Hidden -->
                    <div id="logo-tab" class="tab-panel" style="display: none;">
                        <button class="action-btn" id="upload-logo-btn">+ Upload Logo</button>
                    </div>

                    <!-- Position Tab - Hidden -->
                    <div id="position-tab" class="tab-panel" style="display: none;">
                        <div class="position-controls">
                            <button class="position-btn" data-position="top-left">Top Left</button>
                            <button class="position-btn" data-position="top-right">Top Right</button>
                            <button class="position-btn" data-position="bottom-left">Bottom Left</button>
                            <button class="position-btn" data-position="bottom-right">Bottom Right</button>
                        </div>
                    </div>

                    <!-- Colors Tab -->
                    <div id="colors-tab" class="tab-panel" style="display: none;">
                        <div class="color-controls">
                            <button class="color-btn" data-color="french">French Flag</button>
                            <button class="color-btn" data-color="gradient">Gradient</button>
                            <button class="color-btn" data-color="solid">Solid</button>
                        </div>
                    </div>

                           <!-- Ratio Tab -->
                           <div id="ratio-tab" class="tab-panel" style="display: none;">
                               <div class="ratio-controls">
                                   <button class="ratio-btn active" data-ratio="9:16">9:16</button>
                                   <button class="ratio-btn" data-ratio="4:5">4:5</button>
                               </div>
                           </div>
                </div>
            </div>
        </div>

        <!-- Loading State -->
        <div id="loading" class="state-container hidden">
            <div class="state-card">
                <div class="spinner"></div>
                <h2>Loading...</h2>
            </div>
        </div>
    </main>

    <!-- Workout Selector Modal -->
    <div id="workout-selector-modal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>Select Workout</h3>
                <button class="modal-close" id="close-workout-selector">&times;</button>
            </div>
            <div class="modal-body">
                <div id="workout-list" class="workout-list">
                    <!-- Workouts will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Hidden File Inputs -->
    <input type="file" id="photo-input" accept="image/*" style="display: none;">
    <input type="file" id="logo-input" accept="image/*" style="display: none;">

    </div> <!-- Close mobile-container -->

    <script src="config.js?v=68"></script>
    <script src="polyline.js"></script>
    <script src="app.js?v=68"></script>
    
    <!-- Debug script -->
    <script>
        // Force reset if stuck in loading
        setTimeout(() => {
            const loading = document.getElementById('loading');
            const notConnected = document.getElementById('not-connected');
            if (loading && !loading.classList.contains('hidden') && notConnected) {
                console.log('Force showing not connected state');
                loading.classList.add('hidden');
                notConnected.classList.remove('hidden');
            }
        }, 2000);
        
        // Mobile debug
        console.log('üì± Mobile debug started');
        console.log('Viewport:', window.innerWidth, 'x', window.innerHeight);
        console.log('User agent:', navigator.userAgent);
        
        // Force VSCO-style display on load —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ñ–æ—Ä–º—É–ª–æ–π
        window.addEventListener('load', () => {
            console.log('üì± Page loaded, applying VSCO-style layout with correct formula');
            const container = document.getElementById('mobile-container');
            const previewArea = document.querySelector('.preview-area');
            const connectedState = document.getElementById('connected');
            
            if (container && previewArea) {
                // –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞ —Ä–∞—Å—á–µ—Ç–∞ viewport
                const screenHeight = window.innerHeight;
                const navBarHeight = 60;
                const tabBarHeight = 180;
                const safeAreaInsets = 0; // –¥–ª—è –≤–µ–±-–≤–µ—Ä—Å–∏–∏
                
                const viewportHeight = screenHeight - navBarHeight - tabBarHeight - safeAreaInsets;
                const viewportWidth = viewportHeight * 9 / 16;
                
                // –ü—Ä–æ—Å—Ç–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–∞–∫ –≤ VSCO
                container.style.setProperty('width', '100vw', 'important');
                container.style.setProperty('height', '100vh', 'important');
                container.style.setProperty('display', 'flex', 'important');
                container.style.setProperty('flex-direction', 'column', 'important');
                container.style.setProperty('margin', '0', 'important');
                container.style.setProperty('padding', '0', 'important');
                container.style.setProperty('overflow', 'hidden', 'important');
                
                // Preview area —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ —Ä–∞–∑–º–µ—Ä–∞–º–∏
                previewArea.style.setProperty('width', `${viewportWidth}px`, 'important');
                previewArea.style.setProperty('height', `${viewportHeight}px`, 'important');
                previewArea.style.setProperty('max-width', `${viewportWidth}px`, 'important');
                previewArea.style.setProperty('max-height', `${viewportHeight}px`, 'important');
                previewArea.style.setProperty('display', 'flex', 'important');
                previewArea.style.setProperty('align-items', 'center', 'important');
                previewArea.style.setProperty('justify-content', 'center', 'important');
                previewArea.style.setProperty('margin', '0 auto', 'important');
                
                // Connected state –∑–∞–ø–æ–ª–Ω—è–µ—Ç preview area
                if (connectedState) {
                    connectedState.style.setProperty('width', '100%', 'important');
                    connectedState.style.setProperty('height', '100%', 'important');
                    connectedState.style.setProperty('aspect-ratio', '9 / 16', 'important');
                }
                
                console.log('üì± Viewport calculated:', viewportWidth, 'x', viewportHeight, 'from screen height:', screenHeight);
            }
        });
    </script>
</body>
</html>